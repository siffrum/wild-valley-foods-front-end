<div class="dashboard-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header mb-4">
    <div>
      <h1 class="dashboard-title">
        <i class="bi bi-speedometer2 me-2"></i>Dashboard Overview
      </h1>
      <p class="dashboard-subtitle">Welcome back! Here's what's happening with your business today.</p>
    </div>
    <div class="dashboard-actions">
      <div class="btn-group">
        <button class="btn btn-outline-primary btn-sm" (click)="exportToPDF()" title="Export to PDF">
          <i class="bi bi-file-pdf me-1"></i>Export PDF
        </button>
        <button class="btn btn-outline-success btn-sm" (click)="exportToExcel()" title="Export to Excel">
          <i class="bi bi-file-excel me-1"></i>Export Excel
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="viewModel.loading" class="dashboard-loading">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3 text-muted">Loading dashboard data...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="viewModel.error && !viewModel.loading" class="alert alert-danger alert-dashboard" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <strong>Error:</strong> {{ viewModel.error }}
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!viewModel.loading && !viewModel.error">
    <!-- KPI Cards Section -->
    <div class="kpi-section mb-4">
      <div class="row g-3 g-md-4">
        <div class="col-12 col-sm-6 col-lg-4 col-xl" *ngFor="let card of [
          {title: 'Total Sales', value: totalSales, icon: 'bi-cash-stack', color: 'primary', trend: '+12%'},
          {title: 'Total Orders', value: totalOrders, icon: 'bi-bag-check', color: 'success', trend: '+8%'},
          {title: 'Total Customers', value: totalCustomers, icon: 'bi-people-fill', color: 'info', trend: '+15%'},
          {title: 'Active Users', value: activeUsers, icon: 'bi-person-check', color: 'warning', trend: '+5%'},
          {title: 'Return Rate', value: returnRate, icon: 'bi-arrow-repeat', color: 'danger', trend: '-2%'}
        ]">
          <div class="kpi-card">
            <div class="kpi-card-body">
              <div class="kpi-header">
                <div class="kpi-icon kpi-icon-{{card.color}}">
                  <i class="bi {{card.icon}}"></i>
                </div>
                <div class="kpi-trend kpi-trend-{{card.color}}">
                  <i class="bi bi-arrow-up"></i>
                  <span>{{card.trend}}</span>
                </div>
              </div>
              <div class="kpi-content">
                <h3 class="kpi-value">{{card.value}}</h3>
                <p class="kpi-label">{{card.title}}</p>
              </div>
            </div>
            <div class="kpi-footer">
              <small class="text-muted">
                <i class="bi bi-clock me-1"></i>Updated just now
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section mb-4">
      <div class="row g-3 g-md-4">
        <!-- Monthly Sales Chart -->
        <div class="col-12 col-lg-8">
          <div class="dashboard-card">
            <div class="card-header-modern">
              <div>
                <h5 class="card-title-modern">
                  <i class="bi bi-graph-up-arrow me-2"></i>Monthly Sales Trend
                </h5>
                <p class="card-subtitle">Last 6 months performance</p>
              </div>
              <div class="card-actions">
                <button class="btn-icon" title="View details">
                  <i class="bi bi-three-dots-vertical"></i>
                </button>
              </div>
            </div>
            <div class="card-body-modern">
              <canvas baseChart
                      [data]="barChartData"
                      [options]="barChartOptions"
                      [type]="barChartType">
              </canvas>
            </div>
          </div>
        </div>

        <!-- Category Sales Chart -->
        <div class="col-12 col-lg-4">
          <div class="dashboard-card">
            <div class="card-header-modern">
              <div>
                <h5 class="card-title-modern">
                  <i class="bi bi-pie-chart-fill me-2"></i>Sales by Category
                </h5>
                <p class="card-subtitle">Revenue distribution</p>
              </div>
            </div>
            <div class="card-body-modern">
              <canvas baseChart
                      [data]="pieChartData"
                      [options]="pieChartOptions"
                      [type]="pieChartType">
              </canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Charts Row -->
    <div class="row g-3 g-md-4 mb-4">
      <!-- Daily Visitors Chart -->
      <div class="col-12">
        <div class="dashboard-card">
          <div class="card-header-modern">
            <div>
              <h5 class="card-title-modern">
                <i class="bi bi-bar-chart-line me-2"></i>Daily Website Visitors
                <span *ngIf="viewModel.dailyVisitorsNotification" class="badge bg-warning text-dark ms-2" 
                      title="{{ viewModel.dailyVisitorsNotification.message }}" 
                      style="font-size: 0.65rem; font-weight: normal;">
                  <i class="bi bi-exclamation-triangle-fill me-1"></i>Auto-deletes after 24h
                </span>
              </h5>
              <p class="card-subtitle">Last 30 days traffic analysis</p>
              <!-- Notification Alert -->
              <div *ngIf="viewModel.dailyVisitorsNotification" 
                   class="alert alert-warning alert-dismissible fade show mt-2 mb-0" 
                   role="alert" 
                   style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                <i class="bi bi-info-circle-fill me-2"></i>
                <strong>Note:</strong> {{ viewModel.dailyVisitorsNotification.message }}
                <small class="d-block mt-1 text-muted">
                  <i class="bi bi-clock me-1"></i>Cleanup runs daily at {{ viewModel.dailyVisitorsNotification.cleanupTime }} | 
                  <i class="bi bi-download me-1"></i>{{ viewModel.dailyVisitorsNotification.exportMessage }}
                </small>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="font-size: 0.7rem;"></button>
              </div>
            </div>
            <div class="card-actions">
              <select class="form-select form-select-sm" style="width: auto;">
                <option>Last 30 days</option>
                <option>Last 7 days</option>
                <option>Last 90 days</option>
              </select>
            </div>
          </div>
          <div class="card-body-modern">
            <canvas baseChart
                    [data]="lineChartData"
                    [options]="lineChartOptions"
                    [type]="lineChartType">
            </canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Widgets Section -->
    <div class="widgets-section">
      <div class="row g-3 g-md-4">
        <!-- Recent Orders Widget -->
        <div class="col-12 col-lg-4">
          <div class="dashboard-card widget-card">
            <div class="card-header-modern">
              <div>
                <h5 class="card-title-modern">
                  <i class="bi bi-bag-check me-2"></i>Recent Orders
                </h5>
                <p class="card-subtitle">Latest transactions</p>
              </div>
              <a routerLink="/admin/order" class="btn-link-sm">
                View All <i class="bi bi-arrow-right ms-1"></i>
              </a>
            </div>
            <div class="card-body-modern widget-body">
              <div *ngIf="recentOrders.length > 0; else noRecentOrders" class="widget-list">
                <div class="widget-item" *ngFor="let order of recentOrders">
                  <div class="widget-item-content">
                    <div class="widget-item-main">
                      <div class="widget-item-title">
                        <strong>#{{ order.orderNumber || order.id }}</strong>
                        <span class="badge badge-status" [ngClass]="{
                          'badge-success': order.status === 'paid' || order.status === 'delivered',
                          'badge-warning': order.status === 'shipped' || order.status === 'processing',
                          'badge-danger': order.status === 'failed' || order.status === 'cancelled',
                          'badge-secondary': !order.status
                        }">{{ order.status || 'N/A' }}</span>
                      </div>
                      <p class="widget-item-subtitle">
                        <i class="bi bi-person me-1"></i>{{ order.customerName || 'N/A' }}
                      </p>
                    </div>
                    <div class="widget-item-value">
                      <div class="value-amount">₹{{ order.amount || 0 | number:'1.0-0' }}</div>
                      <small class="text-muted">{{ formatDate(order.createdAt) }}</small>
                    </div>
                  </div>
                </div>
              </div>
              <ng-template #noRecentOrders>
                <div class="widget-empty">
                  <i class="bi bi-inbox"></i>
                  <p>No recent orders</p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Top Products Widget -->
        <div class="col-12 col-lg-4">
          <div class="dashboard-card widget-card">
            <div class="card-header-modern">
              <div>
                <h5 class="card-title-modern">
                  <i class="bi bi-star-fill me-2"></i>Top Products
                </h5>
                <p class="card-subtitle">Best sellers</p>
              </div>
              <a routerLink="/admin/product-list" class="btn-link-sm">
                View All <i class="bi bi-arrow-right ms-1"></i>
              </a>
            </div>
            <div class="card-body-modern widget-body">
              <div *ngIf="topProducts.length > 0; else noTopProducts" class="widget-list">
                <div class="widget-item" *ngFor="let product of topProducts">
                  <div class="widget-item-content">
                    <div class="widget-item-main">
                      <div class="widget-item-title">
                        <strong>{{ product.productName }}</strong>
                      </div>
                      <p class="widget-item-subtitle">
                        <i class="bi bi-upc me-1"></i>SKU: {{ product.sku || 'N/A' }}
                      </p>
                    </div>
                    <div class="widget-item-value">
                      <div class="value-amount">{{ product.totalQuantity || 0 }} sold</div>
                      <small class="text-muted">₹{{ product.totalRevenue || 0 | number:'1.0-0' }}</small>
                    </div>
                  </div>
                </div>
              </div>
              <ng-template #noTopProducts>
                <div class="widget-empty">
                  <i class="bi bi-box"></i>
                  <p>No product data</p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Daily Visitors Widget -->
        <div class="col-12 col-lg-4">
          <div class="dashboard-card widget-card">
            <div class="card-header-modern">
              <div>
                <h5 class="card-title-modern">
                  <i class="bi bi-eye me-2"></i>Daily Visitors
                </h5>
                <p class="card-subtitle">Traffic overview</p>
              </div>
            </div>
            <div class="card-body-modern widget-body">
              <div *ngIf="viewModel.dailyVisitors.length > 0; else noVisitors" class="widget-list">
                <div class="widget-item" *ngFor="let visit of viewModel.dailyVisitors.slice(0, 5)">
                  <div class="widget-item-content">
                    <div class="widget-item-main">
                      <div class="widget-item-title">
                        <strong>{{ visit.date }}</strong>
                      </div>
                      <p class="widget-item-subtitle">
                        <i class="bi bi-clock me-1"></i>Avg: {{ visit.avgTime }}
                      </p>
                    </div>
                    <div class="widget-item-value">
                      <div class="value-amount">{{ visit.visitors }}</div>
                      <small class="text-muted">visitors</small>
                    </div>
                  </div>
                </div>
              </div>
              <ng-template #noVisitors>
                <div class="widget-empty">
                  <i class="bi bi-graph-down"></i>
                  <p>No visitor data</p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
